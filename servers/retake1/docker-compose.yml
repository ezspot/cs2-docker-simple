services:
  cs2-retake1:
    image: joedwards32/cs2:latest
    container_name: cs2-retake1
    restart: unless-stopped
    ports:
      - "${CS2_PORT}:${CS2_PORT}/udp"
      - "${CS2_PORT}:${CS2_PORT}/tcp"
      - "${TV_PORT}:${TV_PORT}/udp"
    env_file: .env
    environment:
      - SRCDS_TOKEN=${SRCDS_TOKEN}
      - CS2_SERVERNAME=${CS2_SERVERNAME}
      - CS2_GAMEALIAS=${CS2_GAMEALIAS}
      - CS2_GAMETYPE=0
      - CS2_GAMEMODE=1
      - CS2_STARTMAP=${CS2_STARTMAP}
      - CS2_MAXPLAYERS=${CS2_MAXPLAYERS}
      - CS2_RCONPW=${CS2_RCONPW}
      - CS2_PW=${CS2_PW}
      - CS2_BOT_QUOTA=${CS2_BOT_QUOTA}
      - TV_ENABLE=${TV_ENABLE}
      - TV_PORT=${TV_PORT}
      - CS2_LOG=${CS2_LOG}
      - DEBUG=${DEBUG}
      - STEAMAPPVALIDATE=${STEAMAPPVALIDATE}
      - CS2_UPDATE_INTERVAL=${CS2_UPDATE_INTERVAL:-0}
      - DISCORD_WEBHOOK_URL=${DISCORD_WEBHOOK_URL}
      - CS2_ADDITIONAL_ARGS=+exec gamemode_retake_server.cfg
    volumes:
      - cs2-retake1-data:/home/steam/cs2-dedicated
      - ../../cfg/gamemode_retake_server.cfg:/home/steam/cs2-dedicated/game/csgo/cfg/gamemode_retake_server.cfg:ro
      - ../../scripts/pre.sh:/home/steam/pre.sh:ro
      - ../../scripts/post.sh:/home/steam/post.sh:ro
      - ../../scripts/notifications.sh:/home/steam/notifications.sh:ro
      - ../../scripts/healthcheck.sh:/home/steam/healthcheck.sh:ro
      - ../../scripts/update_check.sh:/home/steam/update_check.sh:ro
      - ./mapcycle.txt:/home/steam/cs2-dedicated/game/csgo/mapcycle.txt:ro
    healthcheck:
      test: ["CMD", "/bin/bash", "/home/steam/healthcheck.sh"]
      interval: 60s
      timeout: 30s
      retries: 10
      start_period: 3600s

volumes:
  cs2-retake1-data:
    name: cs2-retake1-data
